def p(o):j=len(o)>len(o[0]);n=[*map(list,(o,zip(*o))[j])];d,c=len(n),len(n[0])>>1;b,o=sorted([[o[:c]for o in n],[o[c:]for o in n]],key=lambda o:len(set(sum(o,[]))));x,a=sorted(set(p:=sum(o,[])),key=p.count)[-2:];u=max(set(p:=sum(b,[])),key=p.count);[exec('for o in o[t:t+e]:o[n:n+f]=f*[a]')or[all(b[t+a][n:n+f]==[[a,u][a==x]for a in l[a]]for a in range(e))and exec('for a in range(e):b[t+a][n:n+f]=l[a]')for t in range(d-e+1)for n in range(c-f+1)]for j in range(3,0,-1)for t in range(d)for n in range(c)for e in range(d-t,0,-1)for f in range(c-n,0,-1)if a not in(p:=sum(l:=[o[n:n+f]for o in o[t:t+e]],[]))and e*f-p.count(x)==j];return(b,[*zip(*b)])[j]