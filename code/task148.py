p=lambda d,f=enumerate:[[u&2or u/2or((8in i)&(2in i[n:])^(8in i[n:])|(8in d[b-abs((r:=[*zip(*d)])[0].index(2)-r[-1].index(2))]))*8for n,u in f(i)]for b,i in f(d)]