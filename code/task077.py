p=lambda g,k=22:-k*(g:=[*zip(*g[::-1])])or p([[4*(a!=2)*(c in{2,4})*bool({b,d}&{2,4})or a for a,b,c,d in zip(x,y,(0,)+x,x[1:]+(0,))]for x,y in zip(g,g[:1]+g)],k-1)