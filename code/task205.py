f=lambda g:len(sum(g,[]))
def p(g,r=range):m=len(g);g=max((v for I in r(f(g))for J in r(f(g))if len({*str(v:=[g[k][I//m:J//m+1]for k in r(I%m,J%m+1)])})<7),key=f);return[[[M:=g[0][0],sum(s:={*v,*w})-M][s>{M}]for w in zip(*g)]for v in g]