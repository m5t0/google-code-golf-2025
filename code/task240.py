def p(z,p=enumerate):z=[[max(n[r],n[~r],u[~p],z[~r][~p])for p,n in p(zip(*z))]for r,u in p(z)];return[[n[r]or sum(u&1and(19-p>u>p)*r[p-17]+(19-p<u<p)*r[p-2]for p,u,r in((r,p,u),(p,r,n)))for p,n in p(zip(*z))]for r,u in p(z)]