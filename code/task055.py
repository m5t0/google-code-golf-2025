p=lambda g,s=0:[(t:=0,s:=s+3*all(v))and[[s+(t:=t+(x>0))-6&6*(s+t&5)%9,x][x>0]for x in v]for v in g]