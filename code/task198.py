p=lambda g,k=39:-k*g or p([(t:=0)or[t:=[3+(t==4),t:=x or max(sum(map(bool,V))>7for V in[v,w])+3][t!=3]for w,x in zip(g,v)]for v in zip(*g)][::-1],k-1)