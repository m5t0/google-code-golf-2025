def p(g,e=enumerate):V=sum(g,[]);c=[x for x in{*V}if V.count(x)<3];a=g[0][g[0][0]in c];z=sum({*V}-{*c,a});d=[a,z][any((g[i][j]==c[0])*sum((x==a)-(x==z)for v in g[i-(i>0):i+2]for x in v[j-(j>0):j+2])>0for i,_ in e(g)for j,_ in e(zip(*g)))];h=[[[g[i][j],c[0]][(i+j in[i+j for i,_ in e(g)for j,_ in e(zip(*g))if g[i][j]in c]or i-j in[i-j for i,_ in e(g)for j,_ in e(zip(*g))if g[i][j]in c])*(g[i][j]not in c)]for j,_ in e(zip(*g))]for i,_ in e(g)];return[[[h[i][j],c[g[i][j]in[d,c[1]]]][h[i][j]in c]for j,_ in e(zip(*g))]for i,_ in e(g)]