f=lambda g,e=enumerate:[[w or sum(len(g)>(x:=i+g[-1][j::k].count(2)-g[0][j::k].count(2))>=0and g[x][-(k>0)]for k in[1,-1])for j,w in e(v)]for i,v in e(g)];p=lambda g:[[*zip(*f([*zip(*g)]))],f(g)][2in g[-1]+g[0]]
