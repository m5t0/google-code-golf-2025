n=lambda e,n=enumerate:[[l or sum(len(e)>(q:=d+e[-1][a::n].count(2)-e[0][a::n].count(2))>=0and e[q][-(n>0)]for n in[1,-1])for a,l in n(l)]for d,l in n(e)]
p=lambda e:[[*zip(*n([*zip(*e)]))],n(e)][2in e[-1]+e[0]]