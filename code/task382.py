m=lambda d,m=enumerate:[[n or sum(len(d)>(b:=e+d[-1][_::m].count(2)-d[0][_::m].count(2))>=0and d[b][-(m>0)]for m in[1,-1])for _,n in m(n)]for e,n in m(d)]
p=lambda d:[[*zip(*m([*zip(*d)]))],m(d)][2in d[-1]+d[0]]