o=lambda m,o=enumerate:[[c or sum(len(m)>(l:=n+m[-1][g::k].count(2)-m[0][g::k].count(2))>=0and m[l][-(k>0)]for k in[1,-1])for g,c in o(v)]for n,v in o(m)]
p=lambda m:[[*zip(*o([*zip(*m)]))],o(m)][2in m[-1]+m[0]]