p=lambda g,k=6:-k*(g:=[*zip(*g[::-1])])or p([[[a or(b<0)*b*(-b in x[i:]),-a*(a<0),a-2*a*(len({*x})<2)][2*(k>4)+(k<1)]for i,(a,b)in enumerate(zip(x,(0,)+x))]for x in g],k-1)