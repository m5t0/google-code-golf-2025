s=0,1,0,-1
def p(l,g=range):i=lambda c,j,d:sum(m>(r:=j+s[k-1])>-1<(t:=c+s[k])<u>l[t][r]>2and(d-(k^2)and i(t,r,k))+(m>(r:=j+s[k-2])>-1<(t:=c+s[k-1])<u>l[t][r]>2)for k in g(4));u=len(l);m=len(l[0]);return[[l[c][j]and[0,1,6,2][i(c,j,5)]for j in g(m)]for c in g(u)]