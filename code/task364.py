n=0,1,0,-1
def p(e):a=lambda f,b,s:sum(r>(_:=b+n[d-1])>-1<(q:=f+n[d])<c>e[q][_]>2and(s-(d^2)and a(q,_,d))+(r>(_:=b+n[d-2])>-1<(q:=f+n[d-1])<c>e[q][_]>2)for d in range(4));c=len(e);r=len(e[0]);return[[e[f][b]and[0,1,6,2][a(f,b,5)]for b in range(r)]for f in range(c)]