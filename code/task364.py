d=0,1,0,-1
def p(l,a=range):b=lambda c,j,f:sum(m>(r:=j+d[k-1])>-1<(n:=c+d[k])<h>l[n][r]>2and(f-(k^2)and b(n,r,k))+(m>(r:=j+d[k-2])>-1<(n:=c+d[k-1])<h>l[n][r]>2)for k in a(4));h=len(l);m=len(l[0]);return[[l[c][j]and[0,1,6,2][b(c,j,5)]for j in a(m)]for c in a(h)]