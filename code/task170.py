def p(x):f=sum(x,[]);u=max({*f}-{0},key=f.count);f=[f for f in zip(*[f for f in zip(*x)if f.count(u)>2])if f.count(u)>2];n=len(f)//len(x:=[[*filter(int,x)][-4:]for x,f in zip(x,x[1:])if{*x,*f}-{u,0}][1:]);return[[x/u*f for x,f in zip(x,f[::n])]for x,f in zip(x,f[::n])]