def p(i,a=enumerate):
 r,o=min((r,o)for r,t in a(i)for o,t in a(t)if len(f:={*sum((t[o:o+3]for t in i[r:r+3]),[])})>1>(0in f));p,*u=3+(i[r][o+3]>0),
 for t in i[r:r+p]:u+=[t[o:o+p]];t[o:o+p]=[0]*p
 f=len(e:=[[t[0]for t in zip(t,*i)if any(t)]for t in i if any(t)]);m=f//p;return[[t*(e[m*r][m*o]>0)for o,t in a(t)]for r,t in a(u)]