def p(i,n=enumerate):
 r,z=min((r,z)for r,a in n(i)for z,a in n(a)if len(f:={*sum((a[z:z+3]for a in i[r:r+3]),[])})>1>(0in f));p,*u=3+(i[r][z+3]>0),
 for a in i[r:r+p]:u+=[a[z:z+p]];a[z:z+p]=[0]*p
 f=len(e:=[[a[0]for a in zip(a,*i)if any(a)]for a in i if any(a)]);m=f//p;return[[a*(e[m*r][m*z]>0)for z,a in n(a)]for r,a in n(u)]