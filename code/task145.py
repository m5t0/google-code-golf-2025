r=lambda n,s:(n:=str(n)[1::3]).find('2',s)%-~len(n)+~n.rfind('2',0,s)
p=lambda t,e=enumerate:[[l[m]or((d:=sorted({r(n,s)*r(l,m)for s,l in e(zip(*t))for m,n in e(t)}))[-1]==(a:=r(n,s)*r(l,m)))+(d[1]==a)*8for s,l in e(zip(*t))]for m,n in e(t)]