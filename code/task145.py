t=lambda e,d:(e:=str(e)[1::3]).find('2',d)%-~len(e)+~e.rfind('2',0,d)
p=lambda i,n=enumerate:[[a[f]or((s:=sorted({t(e,d)*t(a,f)for d,a in n(zip(*i))for f,e in n(i)}))[-1]==(r:=t(e,d)*t(a,f)))+(s[1]==r)*8for d,a in n(zip(*i))]for f,e in n(i)]