def p(g,r=range):N=r(n:=len(g));a,b=[i for i in N if len({*g[i]})<2][:2];d=b-a;R=r(d,n-d,d);_,x,y=max((sum(g[i+(k//3-1)*d][j+(k%3-1)*d]>0for k in r(9)),i,j)for i in R for j in R);return[[g[i][j]or next((g[x-p][y-q]for k in r(9)if-1<i+(p:=(k//3-1)*d)<n>j+(q:=(k%3-1)*d)>-1and g[i+p][j+q]==g[x][y]),0)for j in N]for i in N]