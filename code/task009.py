def p(g):r,h=range(len(g)),lambda x,i:{*x[i::-3]}&{*x[i::3]};return[[(i%3<2)*(j%3<2)*max(h([*zip(*g)][j],i)|h(g[i],j))or g[i][j]for j in r]for i in r]