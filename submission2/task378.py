def p(g):v=sum(g,[]);r=range(n:=len(g));return[[v[I:=i*n+j]or max(0<i+(a:=n-(k&2)*n)/n*-~l<n-1>j+(b:=(-1)**k)*-~l>0and(v[x:=I+(a+b)*-~l]<v[x-a]==v[x-b])*v[x+a+b]for k in r[:4]for l in r)for j in r]for i in r]