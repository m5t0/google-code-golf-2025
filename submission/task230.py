def p(g):
 r=range(n:=len(g));return[[g[i][j]or max(n>j+2*(J:=1-k%2*2)>-1<i+(I:=1-k//2*2)*2<n and g[i+I][j+J]&g[i+2*I][j+2*J]and k+1for k in[0,1,2,3])for j in r]for i in r]