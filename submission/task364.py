p=lambda g,k=150:-k*(g:=[*zip(*g)][::-1])or p([[[(a==4)+(a>5)*2+(a==5)*6,(a>0)*max(a,b),(a>0)*(b>0)*(c>0)+a][(k%37>35)+(k>0)]for a,b,c in zip(x,(0,)+x,y)]for x,y in zip(g,[(0,)*len(g[0])]+g)],k-1)