p=lambda g,k=15,l=1:-k*g or p([(b:=0)or[(a>0)*[[b|(b:=a),l:=l*2][a&1],5-a.bit_count()][k<1]for a in r]for r in zip(*g[::-1])],k-1)